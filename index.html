<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sticky Notes</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: sans-serif;
      background-color: #f3f4f6;
      height: 100vh;
      overflow: hidden;
      direction: rtl;
    }
    .toolbar {
      padding: 10px;
      background: #fff;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      display: flex;
      gap: 10px;
      align-items: center;
      justify-content: flex-end;
    }
    .tabs {
      display: flex;
      background: #e5e7eb;
      padding: 5px;
      gap: 5px;
      justify-content: flex-end;
    }
    .tab {
      padding: 5px 10px;
      background: #d1d5db;
      border-radius: 5px;
      cursor: pointer;
      position: relative;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    .tab input {
      font-size: inherit;
      border: none;
      background: transparent;
      padding: 0;
      width: 100px;
      color: inherit;
    }
    .tab input:focus {
      background: white;
      outline: none;
    }
    .tab .delete-tab {
      background: red;
      color: white;
      border: none;
      border-radius: 50%;
      width: 18px;
      height: 18px;
      line-height: 18px;
      font-size: 12px;
      cursor: pointer;
      padding: 0;
    }
    .tab.active {
      background: #9ca3af;
      font-weight: bold;
    }
    .board {
      position: relative;
      width: 100%;
      height: calc(100vh - 100px);
      overflow: auto;
    }
    .note {
      outline: none;
      position: absolute;
      padding: 10px;
      border-radius: 5px;
      box-shadow: 2px 2px 8px rgba(0,0,0,0.2);
      resize: both;
      overflow-x: hidden;
      overflow-y: auto;
      direction: ltr;
      unicode-bidi: plaintext;
      width: 200px;
      height: 150px;
      cursor: move;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
    }
    .note input.title {
      font-weight: bold;
      font-size: 1em;
      border: none;
      background: transparent;
      margin-bottom: 5px;
      width: 100%;
      text-align: right;
      direction: rtl;
      unicode-bidi: plaintext;
    }
    .note textarea {
      flex: 1;
      width: 100%;
      border: none;
      background: transparent;
      resize: none;
      font-family: inherit;
      font-size: 0.95em;
      box-sizing: border-box;
      overflow: auto;
      text-align: right;
      direction: rtl;
      unicode-bidi: plaintext;
    }
    .note:focus-within {
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.4);
    }

    .note textarea:focus,
    .note input.title:focus {
      outline: none;
    }
    .note .delete-button {
      position: absolute;
      bottom: 5px;
      left: 5px;
      background: red;
      color: white;
      border: none;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      line-height: 18px;
      font-size: 14px;
      cursor: pointer;
      padding: 0;
    }
    .arc { background: #fecaca; }
    .chapter { background: #fef08a; }
    .scene { background: #bbf7d0; }
  </style>
</head>
<body>
  <div class="toolbar">
    <input type="text" id="noteText" placeholder="כותרת הפתק">
    <select id="importance">
  <option value="arc">עלילה</option>
  <option value="chapter">פרק</option>
  <option value="scene">סצנה</option>
</select>
    <button onclick="addNote()">הוסף פתק</button>
    <button onclick="addBoard()">הוסף לוח</button>
    <input type="text" id="searchBox" placeholder="חפש פתקים" oninput="searchNotes()">
    <button onclick="exportBoards()">יצא פתקים</button>
    <input type="file" id="importFile" onchange="importBoards()" style="display:none">
    <button onclick="document.getElementById('importFile').click()">ייבא פתקים</button>
  </div><div class="tabs" id="tabs"></div>
  <div class="board" id="board"></div>
  
  

<script>

let selectedNoteId = null;

// Enable copy/paste of notes
let copiedNoteData = null;

document.addEventListener('keydown', function(e) {
  if ((e.ctrlKey || e.metaKey) && e.key === 'c') {
    if (!selectedNoteId) return;
    const boardNotes = boards[currentBoard]?.notes || [];
    const original = boardNotes.find(n => n.id === selectedNoteId);
    if (!original) return;
    copiedNoteData = { ...original };
  }

  if ((e.ctrlKey || e.metaKey) && e.key === 'v' && copiedNoteData) {
    const clone = { ...copiedNoteData };
    clone.left = `${parseInt(clone.left) + 30}px`;
    clone.top = `${parseInt(clone.top) + 30}px`;
    clone.id = Date.now();
    boards[currentBoard].notes.push(clone);
    saveBoards();
    renderBoard();
  }
});
function exportBoards() {
  const data = localStorage.getItem('stickyBoards');
  const blob = new Blob([data], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'stickyBoardsBackup.json';
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
}

function importBoards() {
  const fileInput = document.getElementById('importFile');
  const file = fileInput.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = (e) => {
    try {
      const imported = JSON.parse(e.target.result);
      if (Array.isArray(imported)) {
        boards = imported;
        saveBoards();
        renderTabs();
        renderBoard();
      } else {
        alert('פורמט קובץ לא תקין.');
      }
    } catch (err) {
      alert('שגיאה בקריאת הקובץ.');
    }
  };
  reader.readAsText(file);
}

let currentBoard = 0;
let boards = [];

function addBoard(name = `לוח ${boards.length + 1}`) {
  boards.push({ name, notes: [] });
  currentBoard = boards.length - 1;
  renderTabs();
  renderBoard();
  saveBoards();
}

function deleteBoard(index) {
  if (confirm("האם אתה בטוח שברצונך למחוק את הלוח הזה?")) {
    boards.splice(index, 1);
    if (currentBoard >= boards.length) currentBoard = boards.length - 1;
    if (boards.length === 0) addBoard();
    renderTabs();
    renderBoard();
    saveBoards();
  }
}

function renderTabs() {
  const tabs = document.getElementById('tabs');
  tabs.innerHTML = '';
  boards.forEach((board, i) => {
    const tab = document.createElement('div');
    tab.className = 'tab' + (i === currentBoard ? ' active' : '');

    const input = document.createElement('input');
    input.value = board.name;
    input.onchange = () => {
      board.name = input.value;
      saveBoards();
    };
    tab.appendChild(input);

    const delBtn = document.createElement('button');
    delBtn.textContent = '×';
    delBtn.className = 'delete-tab';
    delBtn.onclick = (e) => {
      e.stopPropagation();
      deleteBoard(i);
    };
    tab.appendChild(delBtn);

    tab.onclick = (e) => {
      if (e.target !== input && e.target !== delBtn) {
        currentBoard = i;
        renderTabs();
        renderBoard();
      }
    };

    tabs.appendChild(tab);
  });
}

function renderBoard() {
  const board = document.getElementById('board');
  board.innerHTML = '';
  if (!boards[currentBoard]) return;
  boards[currentBoard].notes.forEach(noteData => {
    const note = createNoteElement(noteData);
    board.appendChild(note);
  });
}

function createNoteElement(data) {
  if (!data.id) data.id = Date.now();
  const note = document.createElement('div');
  note.dataset.id = data.id;
  note.setAttribute('tabindex', '-1');
  note.className = `note ${data.importance}`;
  note.style.top = data.top;
  note.style.left = data.left;
  note.style.width = data.width;
  note.style.height = data.height;

  const title = document.createElement('input');
  title.className = 'title';
  title.value = data.text;
  title.addEventListener('input', () => {
    data.text = title.value;
    selectedNoteId = data.id;
    saveBoards();
  });
  title.addEventListener('focus', () => {
    selectedNoteId = data.id;
  });
  note.appendChild(title);

  const textarea = document.createElement('textarea');
  textarea.value = data.content || '';
  textarea.placeholder = 'כתוב כאן...';
  textarea.addEventListener('input', () => {
    data.content = textarea.value;
    selectedNoteId = data.id;
    saveBoards();
  });
  textarea.addEventListener('focus', () => {
    selectedNoteId = data.id;
  });
  note.appendChild(textarea);

  const deleteBtn = document.createElement('button');
  deleteBtn.textContent = '×';
  deleteBtn.className = 'delete-button';
  deleteBtn.onclick = () => {
    if (confirm('למחוק את הפתק?')) {
      note.remove();
      boards[currentBoard].notes = boards[currentBoard].notes.filter(n => n !== data);
      saveBoards();
    }
  };
  note.appendChild(deleteBtn);

  // Track selected note
  note.addEventListener('mousedown', () => {
    selectedNoteId = data.id;
  });

  makeDraggable(note, data);
  return note;
}

function makeDraggable(note, data) {
  let offsetX = 0, offsetY = 0, isDragging = false;

  note.addEventListener('mousedown', function(e) {
    if (['textarea', 'button', 'input'].includes(e.target.tagName.toLowerCase())) return;
    selectedNoteId = data.id;
    isDragging = true;
    offsetX = e.clientX - note.offsetLeft;
    offsetY = e.clientY - note.offsetTop;
    note.style.zIndex = 1000;
  });

  document.addEventListener('mousemove', function(e) {
    if (isDragging) {
      note.style.left = `${e.clientX - offsetX}px`;
      note.style.top = `${e.clientY - offsetY}px`;
      data.left = note.style.left;
      data.top = note.style.top;
    }
  });

  document.addEventListener('mouseup', function() {
    if (isDragging) {
      isDragging = false;
      note.style.zIndex = '';
      selectedNoteId = data.id;
      saveBoards();
    }
  });

  const resizeObserver = new ResizeObserver(() => {
    data.width = note.style.width;
    data.height = note.style.height;
    saveBoards();
  });
  resizeObserver.observe(note);
}

function addNote() {
  const text = document.getElementById('noteText').value;
  const importance = document.getElementById('importance').value;
  if (!text.trim()) return;

  const noteData = {
    id: Date.now(),
    text,
    content: '',
    importance,
    top: `${Math.random() * 400}px`,
    left: `${Math.random() * 400}px`,
    width: '200px',
    height: '150px'
  };

  boards[currentBoard].notes.push(noteData);
  saveBoards();
  renderBoard();
  document.getElementById('noteText').value = '';
}

function searchNotes() {
  const query = document.getElementById('searchBox').value.toLowerCase();
  const board = document.getElementById('board');
  board.innerHTML = '';
  const notes = boards[currentBoard]?.notes || [];
  notes.filter(note =>
    note.text.toLowerCase().includes(query) ||
    (note.content && note.content.toLowerCase().includes(query))
  ).forEach(note => board.appendChild(createNoteElement(note)));
}

function saveBoards() {
  localStorage.setItem('stickyBoards', JSON.stringify(boards));
}

function loadBoards() {
  const saved = localStorage.getItem('stickyBoards');
  if (saved) {
    try {
      boards = JSON.parse(saved);
    } catch (e) {
      console.error("שגיאה בטעינת הלוחות", e);
      boards = [];
    }
  }
  if (!Array.isArray(boards) || boards.length === 0) addBoard();
  renderTabs();
  renderBoard();
}


loadBoards();
</script>
  <script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js';

  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyAyVsJreh6PQZTdZqxp1xEBG4WMH6WMxko",
    authDomain: "book-webapp-dcc82.firebaseapp.com",
    projectId: "book-webapp-dcc82",
    storageBucket: "book-webapp-dcc82.firebasestorage.app",
    messagingSenderId: "716789693322",
    appId: "1:716789693322:web:58826d66cfc39439f02673"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // Example: Save data
  async function saveNote() {
    await addDoc(collection(db, "notes"), {
      title: "My first note",
      content: "This is saved in Firebase!"
    });
  }

  // Example: Load data
  async function loadNotes() {
    const querySnapshot = await getDocs(collection(db, "notes"));
    querySnapshot.forEach((doc) => {
      console.log(doc.id, " => ", doc.data());
    });
  }

  // Call functions here if needed
  saveNote();
  loadNotes();
</script>
</body>
</html>
